# 操纵预言机

价格预言机
出于安全性的考虑，以太坊虚拟机（EVM）是一个封闭孤立的沙盒。在EVM上运行的智能合约可以接触链上信息，但无法主动和外界沟通获取链下信息。但是，这类信息对去中心化应用非常重要。

预言机（oracle）可以帮助我们解决这个问题，它从链下数据源获得信息，并将其添加到链上，供智能合约使用。

其中最常用的就是价格预言机（price oracle），它可以指代任何可以让你查询币价的数据源。典型用例：

去中心借贷平台（AAVE）使用它来确定借款人是否已达到清算阈值。
合成资产平台（Synthetix）使用它来确定资产最新价格，并支持 0 滑点交易。
MakerDAO使用它来确定抵押品的价格，并铸造相应的稳定币 $DAI。



知名区块链安全专家 samczsun 在一篇博客中总结了预言机操纵的预防方法，这里总结一下：

不要使用流动性差的池子做价格预言机。
不要使用现货/瞬时价格做价格预言机，要加入价格延迟，例如时间加权平均价格（TWAP）。
使用去中心化的预言机。
使用多个数据源，每次选取最接近价格中位数的几个作为预言机，避免极端情况。
在使用Oracle预言机的询价方法如latestRoundData()，需要对返回结果进行校验，防止使用过时失效数据。
仔细阅读第三方价格预言机的使用文档及参数设置。