# 内存布局

EVM使用内存来支持交易执行期间的数据存储和读取。EVM的内存是一个线性寻址存储器，你可以把它理解为一个动态字节数组，可以根据需要动态扩展。它支持以8或256 bit写入（MSTORE8/MSTORE），但只支持以256 bit读取（MLOAD）。

不会将多个变量压缩保存在同一个内存槽中。

## 预留插槽

    Solidity保留了前4个内存插槽，每个插槽32字节，用于特殊目的：

    0x00 - 0x3f （64字节）：用于哈希方法的临时空间，比如读取mapping里的数据时，要用到key的hash值，key的hash结果就暂存在这里。
    0x40 - 0x5f （32字节）：当前分配的内存大小，又称空闲内存指针（Free Memory Pointer），指向当前空闲的内存位置。Solidity 总会把新对象保存在空闲内存指针的位置，并更新它的值到下一个空闲位置。
    0x60 - 0x7f （32字节）： 32字节的0值插槽，用于需要零值的地方，比如动态长度数据的初始长度值。

## 值变量

每个值变量会占用一个内存插槽。

## 字符串/字节数组

对于内存布局，字符串/字节数组不论长短规则都是一样的。字符串/字节数组长度保存在单独的一个内存槽中，接着是内容，一个内存槽不够的话会顺序保存到后面的内存槽中。

## 静态数组

静态数组的每一个元素会占用一个单独的内存槽。

## 动态数组

动态数组的长度以及每一个元素会占用一个单独的内存槽。

## 多维数组

当数组里存的是可变长度的数据或其他数组时，对应元素的内存槽存的是变长数据在内存中的指针也就是起始地址。
